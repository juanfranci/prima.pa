define("odsp-next/bundles/odc/Notifications",["require","exports","../../dataSources/notifications/odc/NotificationsDataSource","../../providers/notification/NotificationProvider","../../providers/notificationManager/NotificationManager"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})});
define("odsp-next/dataSources/notifications/odc/NotificationsDataSource",["require","exports","@ms/odsp-utilities/lib/resources/Resources","./handlers/NewReferral","./handlers/ProcessReferral","./handlers/SharingAbuse","./handlers/DeleteAll","./handlers/FolderExpiration","./handlers/RestoreAll"],function(e,t,n,r,i,s,o,u,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(){function e(e,t){}e.prototype.loadGlobalHandlers=function(e){e(r.default);e(i.default);e(s.default)};e.prototype.loadPageHandlers=function(e){e(o.default);e(u.default);e(a.default)};return e})();t.default=f;t.resourceKey=n.createResolvedResourceKey(e("module").id,f,{})});
define("odsp-next/dataSources/notifications/odc/handlers/NewReferral",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ProviderResourceKeys","../../Notifications.resx","./NotificationHandlerHelper"],function(e,t,n,r,i,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[3];n._userInfoProvider=n.resources.consume(i.userInfo);n._notifications=n.resources.consume(i.notification);var r=new(n.managed(o.default));n._navigationAction=r.getStorageNavigationAction();return n}t.prototype.handleNotification=function(e){e&&this._showNotification()};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:s.default.inviteFriendNewReferral,action:this._navigationAction,actionText:s.default.inviteFriendNewReferralButton})};t.prototype._showNotification=function(){var e=this,t=function(){e._userInfoProvider.setUserInfo(3,2,null)};this.showNotification().wait().then(t,t)};return t})(r.default);t.default=u});
define("odsp-next/dataSources/notifications/odc/handlers/NotificationHandlerHelper",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ControlResourceKeys","../../../../resources/DataSourceResourceKeys"],function(e,t,n,r,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){n.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.getStorageNavigationAction=function(){var e=this.resources.consume(s.url).getManageStorageUrl()+"?biciid=superbar",t=this.resources.consume(i.actionMap);return new(this.managed(t.NavigationAction))({url:e})};return t})(r.default);t.default=o});
define("odsp-next/dataSources/notifications/odc/handlers/ProcessReferral",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ProviderResourceKeys","../../Notifications.resx","./NotificationHandlerHelper","@ms/odsp-shared/lib/utilities/navigation/Navigation.key","../../../../providers/item/ItemProvider"],function(e,t,n,r,i,s,o,u,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[108];n._notifications=n.resources.consume(i.notification);var r=new(n.managed(o.default));n._navigationAction=r.getStorageNavigationAction();n._processUrl();return n}t.prototype.handleNotification=function(e){};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:"Messages comes from server response... it will say something about user referral",action:this._navigationAction,actionText:s.default.inviteFriendNewReferralButton})};t.prototype._processUrl=function(){var e=this,t=this.resources.consume(u.navigation),n=this.resources.consume(a.resourceKey),r=t.viewParams,i=r.invref,o=r.invsrc;if(i){n.processReferral(i,o).then(function(t){if(t.showIneligiblePopover&&t.ineligiblePopoverMessage){var n={text:t.ineligiblePopoverMessage,action:e._navigationAction,actionText:s.default.inviteFriendIneligibleButton};e._notifications.requestNotification(n)}},function(e){});delete r.invref;delete r.invsrc}};return t})(r.default);t.default=f});
define("odsp-next/dataSources/notifications/odc/handlers/SharingAbuse",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../../../resources/DataSourceResourceKeys","../../Notifications.resx"],function(e,t,n,r,i,s,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[23];n._notifications=n.resources.consume(s.notification);n._createAction();return n}t.prototype.handleNotification=function(e){e&&e.param&&e.param.indexOf("IsNotOwner")>=0&&this.showNotification()};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:u.default.sharingAbuseDescription,severity:2,action:this._navigationAction,actionText:u.default.sharingAbuseButtonText})};t.prototype._createAction=function(){var e=this.resources.consume(o.url),t=e.getOwnerId(),n=e.getSharedByUrl(t,t),r=this.resources.consume(i.actionMap);this._navigationAction=new(this.managed(r.NavigationAction))({url:n})};return t})(r.default);t.default=a});
define("odsp-next/dataSources/notifications/odc/handlers/DeleteAll",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../Notifications.resx"],function(e,t,n,r,i,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[103];n.listenToCurrentItem=!0;n._notifications=n.resources.consume(s.notification);n._currentItem=n.resources.consume(i.currentItem);n.createComputed(n._proccessItemChanged);return n}t.prototype.handleNotification=function(e){};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:this._text||o.default.deleteAllStatusUnknownCount})};t.prototype._proccessItemChanged=function(){var e=this._currentItem();if(e&&e.taskStatus&&e.taskStatus.deleteAllCount){switch(e.taskStatus.deleteAllCount){case-1:this._text=o.default.deleteAllStatusUnknownCount;break;default:this._text=o.default.deleteAllStatus}e.taskStatus.deleteAllCount=0;this.showNotification()}};return t})(r.default);t.default=u});
define("odsp-next/dataSources/notifications/odc/handlers/FolderExpiration",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../actions/base/ItemCommandHelper","@ms/odsp-utilities/lib/string/StringHelper","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../../../resources/DataSourceResourceKeys","@ms/odsp-utilities/lib/logging/events/Engagement.event","../../Notifications.resx","../../../../models/item/command/FileSystemItemCommandKeys"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h={},p=(function(e){n.__extends(t,e);function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;n.types=[101];n.listenToCurrentItem=!0;n._notifications=n.resources.consume(u.notification);n._currentItem=n.resources.consume(o.currentItem);n._urlDataSource=n.resources.consume(a.url);n._itemCommandHelper=new(n.managed(i.default));n.createBackgroundComputed(n._proccessItemChanged);return n}t.prototype.handleNotification=function(e){};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:this._getDetails(),severity:2,action:this._getAction(),actionText:l.default.folderExpirationChangeSettings})};t.prototype._proccessItemChanged=function(){var e=this._currentItem();if(e&&!e.isPlaceholder&&!h[e.id]&&e.dateExpires&&this._itemCommandHelper.isCommandSupported(e,c.changeExpiration)){f.Engagement.logData({name:"Notifications.FolderExpiration.View"});this.showNotification()}};t.prototype._getDetails=function(){var e=this._currentItem.peek();return s.format(l.default.folderExpirationFormat,e.dateExpires||"")};t.prototype._getAction=function(){var e=this._currentItem.peek(),t=this._urlDataSource.getChangeFolderExpirationUrl(e.id),n=this.resources.consume(o.actionMap);return new(this.managed(n.NavigationAction))({url:t})};return t})(r.default);t.default=p});
define("odsp-next/dataSources/notifications/odc/handlers/RestoreAll",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../Notifications.resx"],function(e,t,n,r,i,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[102];n.listenToCurrentItem=!0;n._notifications=n.resources.consume(s.notification);n._currentItem=n.resources.consume(i.currentItem);n.createComputed(n._proccessItemChanged);return n}t.prototype.handleNotification=function(e){};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:this._text||o.default.restoreAllStatusUnknownCount})};t.prototype._proccessItemChanged=function(){var e=this._currentItem();if(e&&e.taskStatus&&e.taskStatus.restoreAllCount){switch(e.taskStatus.restoreAllCount){case-1:this._text=o.default.restoreAllStatusUnknownCount;break;default:this._text=o.default.restoreAllStatus}e.taskStatus.restoreAllCount=0;this.showNotification()}};return t})(r.default);t.default=u});
define("odsp-next/providers/notification/NotificationProvider",["require","exports","tslib","knockout","@ms/odsp-shared/lib/base/BaseModel","@ms/odsp-utilities/lib/browser/PlatformDetection.key","@ms/odsp-utilities/lib/resources/Resources","../../models/notification/Notification"],function(e,t,n,r,i,s,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){n.__extends(t,e);function t(t,n){void 0===t&&(t={});var i=e.call(this,t,n)||this;i.handledNotifications={};i._notifications=r.observableArray([]);i._platformDetection=n.platformDetection;i.currentNotification=i.createComputed(function(){var e=i._notifications();return e.length&&e.sort(function(e,t){return e.severity===t.severity?0:e.severity>t.severity?-1:1})[0]||null});return i}t.prototype.requestNotification=function(e){var t=this,n=new u.default(e);if(!this._platformDetection.isIE||this._platformDetection.browserMajor>9){this._notifications.push(n);var r=function(){t._notifications.remove(n)};n.wait().then(r,r)}return n};t.dependencies=n.__assign(n.__assign({},i.default.dependencies),{platformDetection:s.platformDetection});return t})(i.default);t.NotificationProvider=a;t.resourceKey=o.createResolvedResourceKey(e("module").id,a)});
define("odsp-next/models/notification/Notification",["require","exports","tslib","@ms/odsp-utilities/lib/async/Signal","@ms/odsp-shared/lib/base/BaseModel"],function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,{})||this;n.text=t.text||"";n.severity=t.severity||1;n.dismissalType=t.dismissalType||2;n.timeout=t.timeout||0;n.action=t.action;n.actionText=t.actionText||"";n.isOpen=n.createObservable(!0);n.state=n.createObservable(1);n.canImplicitDismiss=2===n.dismissalType||3===n.dismissalType;n.showCloseButton=4!==n.dismissalType;var i=new r.default;n.createComputed(function(){var e=n.state();1!==e&&(2===e?i.complete(2):i.cancel())});n._promise=i.getPromise();return n}t.prototype.complete=function(){this.isOpen(!1);this.state(2)};t.prototype.dismiss=function(){this.isOpen(!1);this.state(3)};t.prototype.wait=function(){return this._promise};return t})(i.default);t.default=s});
define("odsp-next/providers/notificationManager/NotificationManager",["require","exports","tslib","knockout","@ms/odsp-shared/lib/base/BaseModel","@ms/odsp-utilities/lib/browser/PlatformDetection.key","@ms/odsp-utilities/lib/resources/Resources","../../resources/ModelResourceKeys","../../resources/ProviderResourceKeys","../../resources/DataSourceResourceKeys"],function(e,t,n,r,i,s,o,u,a,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});0;var l=(function(e){n.__extends(t,e);function t(t,n){void 0===t&&(t={});var r=e.call(this,t,n)||this;r._isFirstProcess=!0;if(!n.userInfoProvider.isAuthenticated())return r;if(n.platformDetection.isMobile)return r;var i=n.userInfoStore;r._userInfo=i.getUserInfo();r._handlers={};r._notifications=n.notifications;r._notificationProvider=n.notificationProvider;r._notifications.loadGlobalHandlers(r._getLoader());r.createComputed(r._computeProcessNotifications);r.createComputed(r._computeProcessTriggeredNotifications);return r}t.triggerNotification=function(e){this._triggeredNotifications.push(e)};t.prototype.createNotificationHandlers=function(e){this._notifications.loadPageHandlers(this._getLoader(e))};t.prototype._getLoader=function(e){var t=this;return function(n){for(var r=e?e(n):new(t.managed(n)),i=0,s=r.types;i<s.length;i++){var o=s[i];t._handlers[o]=r}t._isFirstProcess||t._processHandler(r)}};t.prototype._processHandler=function(e){var t=this._userInfo();if(t){for(var n={},r=0,i=e.types;r<i.length;r++){n[i[r]]=!0}if(t&&t.notifications)for(var s=0,o=t.notifications;s<o.length;s++){var u=o[s];n[u.type]&&this._shouldShowNotification(u,!1)&&this._handleNotification(u)}}};t.prototype._computeProcessNotifications=function(){var e=this._userInfo();if(e&&e.notifications){for(var t=0,n=e.notifications;t<n.length;t++){var r=n[t];this._shouldShowNotification(r,this._isFirstProcess)&&this._handleNotification(r)}this._isFirstProcess=!1}};t.prototype._computeProcessTriggeredNotifications=function(){for(var e=t._triggeredNotifications(),n=0;n<e.length;n++){var r=this._handlers[e[n]];if(r){r.showNotification();e.splice(n--,1)}}t._triggeredNotifications(e)};t.prototype._shouldShowNotification=function(e,t){return!(!e||!e.id&&t)&&(!this._notificationProvider.handledNotifications[e.id]&&!this._isExpired(e))};t.prototype._isExpired=function(e){if(e.id&&e.expiryDateTime){var t=new Date(e.expiryDateTime);if((new Date).getTime()>t.getTime()){this._notificationProvider.handledNotifications[e.id]=!0;return!0}}if(e.id&&e.expiryDate){t=new Date(e.expiryDate);if((new Date).getTime()>t.getTime()+864e5){this._notificationProvider.handledNotifications[e.id]=!0;return!0}}return!1};t.prototype._handleNotification=function(e){var t=this._handlers[e.type];if(!t)return!1;t.handleNotification(e);e.id&&(this._notificationProvider.handledNotifications[e.id]=!0);return!0};t.dependencies=n.__assign(n.__assign({},i.default.dependencies),{platformDetection:s.platformDetection,userInfoStore:u.userInfoStore,userInfoProvider:a.userInfo,notifications:f.notifications,notificationProvider:a.notification});t._triggeredNotifications=r.observableArray();return t})(i.default);t.default=l;t.resourceKey=o.createResolvedResourceKey(e("module").id,l)});